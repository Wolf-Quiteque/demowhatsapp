(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[847],{3398:function(e,a,s){"use strict";s.r(a);var t=s(29),n=s(7794),r=s.n(n),i=s(5893);a.default=function(e){var a=e.likes,s=e.id,n=e.user,l=e.posts,o=(e.postArray,!1);a&&a.includes(n.email)&&(o=!0);var c=function(){var e=(0,t.Z)(r().mark((function e(a){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("/api/posts/like",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:a,email:n.email})});case 2:e.sent;case 3:case"end":return e.stop()}}),e)})));return function(a){return e.apply(this,arguments)}}();return(0,i.jsx)("i",{className:"fa fa-star me-2 ".concat(o?"text-warning":""),style:{cursor:"pointer"},onClick:function(){if(!o){var e=l.find((function(e){return e._id===s}));e&&(e.likes||(e.likes=[]),e.likes.push(n.email),o=!0,c(s,n.email))}}})}},9443:function(e,a,s){"use strict";function t(e,a){(null==a||a>e.length)&&(a=e.length);for(var s=0,t=new Array(a);s<a;s++)t[s]=e[s];return t}function n(e){return function(e){if(Array.isArray(e))return t(e)}(e)||function(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,a){if(e){if("string"===typeof e)return t(e,a);var s=Object.prototype.toString.call(e).slice(8,-1);return"Object"===s&&e.constructor&&(s=e.constructor.name),"Map"===s||"Set"===s?Array.from(e):"Arguments"===s||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s)?t(e,a):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}s.r(a),s.d(a,{default:function(){return b}});var r=s(29),i=s(7794),l=s.n(i),o=s(9008),c=s(7294),m=s(782),d=(s(4213),s(6304)),u=s(3398),p=s(1163),h=s(5893),b=function(){var e,a=(0,c.useState)(null),s=a[0],t=a[1],i=(0,c.useState)(""),b=i[0],f=i[1],g=(0,c.useState)(null),x=g[0],j=g[1],v=(0,p.useRouter)(),N=(0,c.useState)([]),y=(N[0],N[1],(0,c.useState)([])),w=(y[0],y[1],(0,c.useState)("")),k=w[0],C=w[1],S=(0,c.useState)([]),P=S[0],O=S[1],_=(0,c.useState)(!1),A=_[0],T=_[1],E=(0,c.useState)(!1),z=E[0],D=E[1],I=(0,c.useState)(null),L=I[0],U=I[1],B=(0,c.useState)([]),Z=B[0],F=B[1],H=(0,c.useState)(!1),J=H[0],R=H[1],X=[],Y=function(){var e=(0,r.Z)(l().mark((function e(){var a;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,d.QN)("authsesh");case 2:return a=e.sent,R(a),e.abrupt("return",a);case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,c.useEffect)((function(){return window.addEventListener("scroll",q),function(){return window.removeEventListener("scroll",q)}}),[]);var q=function(){window.innerHeight+document.documentElement.scrollTop===document.documentElement.offsetHeight&&console.log("Loading more posts...")},M=function(){var e=(0,r.Z)(l().mark((function e(){var a,s;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("/api/posts/allposts",{method:"POST",headers:{"Content-Type":"application/json"}});case 2:return a=e.sent,e.next=5,a.json();case 5:s=e.sent,F(s);case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Q=function(){var e=(0,r.Z)(l().mark((function e(a){var s,t;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("/api/posts/allcoments",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:a})});case 2:return s=e.sent,e.next=5,s.json();case 5:t=e.sent,O(t);case 7:case"end":return e.stop()}}),e)})));return function(a){return e.apply(this,arguments)}}(),$=function(){var e=(0,r.Z)(l().mark((function e(){var a,s,t;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=new Date,s={id:z,nome:J.nome,email:J.email,classe:[J.classe],timestamp:a,avatar:[J.avatar],commentario:k},O(P?[].concat(n(P),[s]):[s]),(t=(X=Z).find((function(e){return e._id===z})))&&(t.comments||(t.comments=[]),t.comments.push(s)),e.next=8,fetch("/api/posts/comment",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});case 8:e.sent,C("");case 10:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),G=function(){var a=(0,r.Z)(l().mark((function a(){var s,t,n,r,i;return l().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return U(null),e=m.Am.loading("aguarde...",{closeOnClick:!0}),a.next=4,Y();case 4:if(s=a.sent,t={email:s.email,timestamp:new Date},!x){a.next=16;break}return n=new FormData,r=Date.now()+x.name,n.append("file",x),n.append("name",r),n.append("upload_preset","rvtitoz5"),a.next=14,fetch("https://api.cloudinary.com/v1_1/dup24qnij/image/upload",{method:"Post",body:n}).then((function(e){return e.json()}));case 14:i=a.sent,t.imageUrl=i.secure_url;case 16:return b&&(t.content=b),a.prev=17,a.next=20,fetch("/api/posts/novo",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});case 20:a.sent,M(),m.Am.update(e,{render:"postado!",type:"success",isLoading:!1,closeOnClick:!0,autoClose:1e3}),T(!1),a.next=29;break;case 26:a.prev=26,a.t0=a.catch(17),m.Am.update(e,{render:"Houve um erro",type:"error",isLoading:!1,closeOnClick:!0,autoClose:1e3});case 29:case"end":return a.stop()}}),a,null,[[17,26]])})));return function(){return a.apply(this,arguments)}}();return(0,c.useEffect)((function(){M(),J||Y(),X=Z}),[Z]),(0,h.jsxs)("div",{className:"container",children:[(0,h.jsxs)(o.default,{children:[(0,h.jsx)("title",{children:"Communidade - Anje-Angola"}),(0,h.jsx)("link",{rel:"icon",href:"/favicon.ico"})]}),(0,h.jsxs)("main",{children:[(0,h.jsx)(m.Ix,{}),(0,h.jsx)("div",{style:{position:"fixed",bottom:"20px",right:"20px",zIndex:"1000"},children:J&&J.pago?(0,h.jsx)("button",{className:"btn btn-primary",onClick:function(){return U(!0)},children:"Novo Post"}):(0,h.jsxs)("button",{className:"btn btn-primary ",disabled:!0,children:["Activa Conta ",(0,h.jsx)("br",{}),"para Publicar"]})}),(0,h.jsx)("div",{className:"modal ".concat(L?"show":""),tabIndex:"-1",role:"dialog",style:{display:L?"block":"none"},children:(0,h.jsx)("div",{className:"modal-dialog",role:"document",children:(0,h.jsxs)("div",{className:"modal-content",children:[(0,h.jsxs)("div",{className:"modal-header",children:[(0,h.jsx)("h5",{className:"modal-title",children:"Novo Post"}),(0,h.jsx)("button",{type:"button",className:"btn-close","data-bs-dismiss":"modal","aria-label":"Close",onClick:function(){return U(!1)},children:(0,h.jsx)("i",{className:"fas fa-times"})})]}),(0,h.jsxs)("div",{className:"modal-body",style:{maxHeight:"75vh",overflowY:"auto"},children:[(0,h.jsx)("div",{className:"row",children:(0,h.jsx)("div",{className:"col-md-12"})}),(0,h.jsx)("div",{className:"col-md-12",children:(0,h.jsxs)("label",{htmlFor:"file",children:[(0,h.jsxs)("a",{children:[" ",(0,h.jsxs)("i",{className:"bi bi-camera-fill",style:{fontSize:"50px"},children:[" ","+"]})]}),(0,h.jsx)("input",{type:"file",id:"file",accept:".png,.jpeg,.jpg",onChange:function(e){j(e.target.files[0]),T(URL.createObjectURL(e.target.files[0]))},style:{display:"none"}})]})}),A&&(0,h.jsxs)("div",{className:"col-md-12",children:[(0,h.jsx)("div",{className:"float-right",children:(0,h.jsx)("a",{className:"btn btn-sm btn-danger mb-2",onClick:function(){T(!1)},children:(0,h.jsx)("i",{className:"bi bi-x"})})}),(0,h.jsx)("img",{className:"img-fluid",src:A})]}),(0,h.jsxs)("div",{className:"mb-3",children:[(0,h.jsxs)("label",{htmlFor:"postCaption",className:"form-label",children:["Escrever ",(0,h.jsx)("i",{className:"fa fa-pencil-alt"})]}),(0,h.jsx)("textarea",{type:"text",className:"form-control",rows:4,id:"postCaption",value:b,onChange:function(e){return f(e.target.value)}})]})]}),(0,h.jsx)("div",{className:"modal-footer",children:(0,h.jsx)("button",{type:"button",className:"btn btn-primary",onClick:G,children:"Post"})})]})})}),(0,h.jsxs)("div",{className:"row mt-2",children:[" ",(0,h.jsx)("div",{className:"modal ".concat(s?"show":""),tabIndex:"-1",role:"dialog",style:{display:s?"block":"none"},children:(0,h.jsx)("div",{className:"modal-dialog",role:"document",children:(0,h.jsxs)("div",{className:"modal-content",children:[(0,h.jsxs)("div",{class:"modal-header",children:[(0,h.jsx)("h5",{class:"modal-title",children:"Comentarios"}),(0,h.jsx)("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close",onClick:function(){t(!1)},children:(0,h.jsx)("i",{className:"fas fa-times"})})]}),(0,h.jsx)("div",{className:"modal-body",style:{maxHeight:"75vh",overflowY:"auto"},children:(0,h.jsx)("div",{className:"card card-widget",children:(0,h.jsx)("div",{className:"card-footer card-comments",children:P&&P.map((function(e){return(0,h.jsxs)("div",{className:"card-comment",children:[(0,h.jsx)("img",{className:"img-circle img-sm",src:e.avatar?e.avatar:"https://picsum.photos/200/300",alt:"User Image",style:{objectFit:"cover"}}),(0,h.jsxs)("div",{className:"comment-text",children:[(0,h.jsxs)("span",{className:"username",children:[e.nome,"diamante"===e.classe[0]&&(0,h.jsx)("span",{className:"badge float-right bg-primary ml-3",children:"Diamante"}),"ouro"===e.classe[0]&&(0,h.jsx)("span",{className:"badge float-right bg-warning ml-3",children:"Ouro"}),"platina"===e.classe[0]&&(0,h.jsx)("span",{className:"badge float-right bg-silver ml-3",style:{backgroundColor:"#424242"},children:"Platina"}),"prata"===e.classe[0]&&(0,h.jsx)("span",{className:"badge float-right bg-silverlight ml-3",style:{backgroundColor:"#424242"},children:"Prata"}),"bronze"===e.classe[0]&&(0,h.jsx)("span",{className:"badge float-right bg-brown ml-3",style:{backgroundColor:"#8b4513"},children:"Bronze"}),"Diamante"===e.classe[0]&&(0,h.jsx)("span",{className:"badge float-right bg-primary ml-3",children:"Diamante"}),"Ouro"===e.classe[0]&&(0,h.jsx)("span",{className:"badge float-right bg-warning ml-3",children:"Ouro"}),"Platina"===e.classe[0]&&(0,h.jsx)("span",{className:"badge float-right bg-silver ml-3",style:{backgroundColor:"#424242"},children:"Platina"}),"Prata"===e.classe[0]&&(0,h.jsx)("span",{className:"badge float-right bg-silverlight ml-3",style:{backgroundColor:"#424242"},children:"Prata"}),"Bronze"===e.classe[0]&&(0,h.jsx)("span",{className:"badge float-right bg-brown ml-3",style:{backgroundColor:"#8b4513"},children:"Bronze"})]}),e.commentario]})]})}))})})}),(0,h.jsx)("div",{className:"",children:(0,h.jsxs)("div",{className:"row",children:[(0,h.jsx)("div",{className:"col-md-10 ",children:(0,h.jsx)("input",{className:"form-control",type:"text",placeholder:"tens algo a dizer?",value:k,onChange:function(e){C(e.target.value)},style:{width:"100%"}})}),(0,h.jsx)("div",{className:"col-md-2",children:J.pago?(0,h.jsx)("button",{className:"btn btn-primary",style:{width:"100%"},onClick:function(){$()},children:"enviar"}):(0,h.jsx)("button",{className:"btn btn-primary",disabled:!0,style:{width:"100%"},children:"enviar"})})]})})]})})}),Z.map((function(e){return(0,h.jsxs)(h.Fragment,{children:[(0,h.jsx)("div",{className:"col-md-4"}),(0,h.jsx)("div",{className:"col-sm-12 col-md-4 mt-2 mb-4",children:(0,h.jsxs)("div",{className:"card",children:[(0,h.jsxs)("div",{className:"card-header",style:{cursor:"pointer"},onClick:function(){v.replace("/membro/"+e.email)},children:[(0,h.jsx)("img",{className:"direct-chat-img mr-3",style:{height:"30px",width:"30px"},src:e.avatar?e.avatar:"https://picsum.photos/200/300",alt:"foto"}),e.user.name,"diamante"===e.user.membership&&(0,h.jsx)("span",{className:"badge bg-primary ml-3",children:"Diamante"}),"ouro"===e.user.membership&&(0,h.jsx)("span",{className:"badge bg-warning ml-3",children:"Ouro"}),"platina"===e.user.membership&&(0,h.jsx)("span",{className:"badge bg-silver ml-3",style:{backgroundColor:"#424242"},children:"Platina"}),"prata"===e.user.membership&&(0,h.jsx)("span",{className:"badge bg-silverlight ml-3",style:{backgroundColor:"#424242"},children:"Prata"}),"bronze"===e.user.membership&&(0,h.jsx)("span",{className:"badge bg-brown ml-3",style:{backgroundColor:"#8b4513"},children:"Bronze"}),"Diamante"===e.user.membership&&(0,h.jsx)("span",{className:"badge bg-primary ml-3",children:"Diamante"}),"Ouro"===e.user.membership&&(0,h.jsx)("span",{className:"badge bg-warning ml-3",children:"Ouro"}),"Platina"===e.user.membership&&(0,h.jsx)("span",{className:"badge bg-silver ml-3",style:{backgroundColor:"#424242"},children:"Platina"}),"Prata"===e.user.membership&&(0,h.jsx)("span",{className:"badge bg-silverlight ml-3",style:{backgroundColor:"#424242"},children:"Prata"}),"Bronze"===e.user.membership&&(0,h.jsx)("span",{className:"badge bg-brown ml-3",style:{backgroundColor:"#8b4513"},children:"Bronze"})]}),e&&e.imageUrl&&(0,h.jsx)("img",{src:e.imageUrl,className:"card-img-top",style:{cursor:"pointer"},alt:"Post"}),(0,h.jsxs)("div",{className:"card-body",children:[(0,h.jsx)("p",{className:"card-text",children:e&&e.content&&e.content}),(0,h.jsxs)("div",{className:"d-flex justify-content-between align-items-center",children:[(0,h.jsxs)("div",{children:[(0,h.jsx)("small",{className:"mr-1",children:e&&e.comments&&e.comments.length}),(0,h.jsx)("i",{className:"fa fa-comment mr-2",style:{cursor:"pointer"},onClick:function(){var a;a=e._id,t(a),D(e._id),Q(e._id)}})," ",(0,h.jsx)("small",{className:"mr-1",children:e&&e.likes&&e.likes.length}),(0,h.jsx)(u.default,{user:J,likes:e.likes,id:e._id,posts:Z,postArray:X})]}),(0,h.jsx)("small",{className:"text-muted",children:new Date(e.timestamp).toLocaleDateString("pt-PT",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit"})})]})]})]})},e._id)," ",(0,h.jsx)("div",{className:"col-md-4"})]})}))]})]})]})}},6423:function(e,a,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/comunidade",function(){return s(9443)}])}},function(e){e.O(0,[324,774,888,179],(function(){return a=6423,e(e.s=a);var a}));var a=e.O();_N_E=a}]);